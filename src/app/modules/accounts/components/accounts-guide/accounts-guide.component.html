<div class="accounts-guide">
  <app-navigator [title]="title"></app-navigator>
  <div
    class="head flex gap-2 flex-wrap items-end justify-between justify-content-md-center"
  >
    <div class="row">
      <div class="col-md-5 col-8">
        <div class="tree">
          <tree-ngx
          [nodeItems]="AccountngxTree"
          class="{{ 'dir' | translate }}"
          (selectedItems)="selectedTask1 = $event;"
          [options]="options"
          (click)="selectedTree();"
        >
          <ng-template #nodeCollapsibleTemplate let-expanded="expanded">
            <span *ngIf="!expanded">
              <i class="fa-solid fa-folder-plus tree-icon"></i>
            </span>
            <span *ngIf="expanded">
              <i class="fa-solid fa-folder-minus tree-icon"></i>
            </span>
          </ng-template>
        </tree-ngx>
        </div>
      </div>
      <div class="col-md-7 col-8">
        <div class="row align-items-center bg-white mx-3">
          <h3 class="fw-bold m-3">{{ "AccountInformation" | translate }}</h3>
          <div class="col-xxl-6 col-lg-4 col-md-3 mb-0 mb-md-3">
            <div class="form-group">
              <label class="col-form-label">
                {{ "account code" | translate }}</label
              >
              <input
                type="text "
                class="w-full p-2 inputType"
                readonly
                name="accountCode"autocomplete="off"
                [(ngModel)]="acountCode"
                placeholder="{{ 'account code' | translate }}"
              />
            </div>
          </div>
          <!-- 2 -->
          <div class="col-xxl-3 col-lg-4 col-md-5 mb-0 mb-md-3">
            <div class="form-group">
              <label class="col-form-label">
                {{ "MainAccountCode" | translate }}</label
              >

              <input
                type="text "
                class="w-full p-2 inputType"
                name="MainAccountCode"autocomplete="off"
                placeholder="{{ 'MainAccountCode' | translate }}"
                [(ngModel)]="MainAccountCode"
                (keyup)="GetAccountByCode()"
                disabled
              />
            </div>
          </div>

          <div class="col-xxl-3 col-lg-4 col-md-5 mb-0 mb-md-3">
            <div class="form-group">
              <label class="col-form-label">
                {{ "MainAccountName" | translate }}</label
              >

              <input
                type="text "
                class="w-full p-2 inputType"
                name="MainAccountName"autocomplete="off"
                placeholder="{{ 'MainAccountName' | translate }}"
                [(ngModel)]="MainAccountName"
                disabled
              />
            </div>
          </div>
          <!-- 3 -->
          <div class="col-xxl-3 col-lg-4 col-md-5 mb-0 mb-md-3">
            <div class="form-group">
              <label class="col-form-label">
                {{ "ArabicAccount" | translate }}</label
              >

              <input
                type="text "
                class="w-full p-2 inputType"autocomplete="off"
                name="ArabicAccount"
                [(ngModel)]="accountNameAR"
                placeholder="{{ 'ArabicAccount' | translate }}"
                [disabled]="selectItemOftree==true"
              />
            </div>
          </div>

          <div class="col-xxl-3 col-lg-4 col-md-5 mb-0 mb-md-3">
            <div class="form-group">
              <label class="col-form-label">
                {{ "LatinAccount" | translate }}</label
              >

              <input
                type="text "
                class="w-full p-2 inputType"
                name="LatinAccount"
                [(ngModel)]="accountNameEn"
                placeholder="{{ 'LatinAccount' | translate }}"
                [disabled]="selectItemOftree==true"autocomplete="off"
              />
            </div>
          </div>
          <!-- 4-->
          <div class="col-xxl-4 col-lg-5 col-md-5 mb-0 mb-md-3">
            <div class="form-group">
              <label class="col-form-label"> {{ "Type" | translate }}</label>
              <ng-select
                class="w-full p-0"autocomplete="off"
                placeholder="{{ 'Chose' | translate }}"
                ngModel
                name="Type"
                [(ngModel)]="Type"
                [disabled]="selectItemOftree==true"
              >
                <ng-option *ngFor="let user of TypeList" [value]="user.id">{{ user.name }}</ng-option>
              </ng-select>
            </div>
          </div>

          <div class="col-xxl-4 col-lg-5 col-md-5 mb-0 mb-md-3">
            <div class="form-group">
              <label class="col-form-label">
                {{ "Category" | translate }}</label
              >
              <ng-select
                class="w-full p-0"
                placeholder="{{ 'Chose' | translate }}"autocomplete="off"
                ngModel
                name="Category"
                [(ngModel)]="classification"
                [disabled]="selectItemOftree==true"
              >
                <ng-option *ngFor="let user of classificationList" [value]="user.id">{{user.name}}</ng-option>
              </ng-select>
            </div>
          </div>

          <div class="col-xxl-4 col-lg-5 col-md-5 mb-0 mb-md-3">
            <div class="form-group">
              <label class="col-form-label">
                {{ "accountLevel" | translate }}</label
              >

              <input
                type="text "
                class="w-full p-2 inputType"autocomplete="off"
                disabled
                name="accountLevel"
                placeholder="{{ 'accountLevel' | translate }}"
                [(ngModel)]="accountLevel"
              />
            </div>
          </div>
          <!-- 5 -->

          <div class="col-xxl-4 col-lg-5 col-md-5 mb-0 mb-md-3">
            <div class="form-check form-switch position-relative my-4 flex-col">
              <label
                class="form-check-label mb"
                for="flexSwitchCheckDefault"
                style="width: max-content"
              >
                {{ "natureAccount" | translate }}
              </label>
              <br />
              <div
                class="form-types checkbox h-full flex-column position-absolute e-0"
              >
                <div class="checkbox-content relative {{ 'dir' | translate }}">
                  <!-- [checked]="item.status == 2" -->
                  <input
                    type="checkbox"
                    name="check"
                    [ngModel]="Nature"
                    #checkbox="ngModel"
                    [disabled]="selectItemOftree==true"
                    (change)="changeRequestStatus($event)"
                  />
                  <div class="box {{ Nature ? 'checked' : 'blur' }}">
                    <span class="absolute">{{ "Creditor" | translate }}</span>
                    <span class="absolute">{{ "debtor" | translate }}</span>
                    <div class="cycle"></div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="col-xxl-4 col-lg-5 col-md-5 mb-0 mb-md-3">
            <div class="form-check form-switch position-relative my-4 flex-col">
              <label
                class="form-check-label mb"
                for="flexSwitchCheckDefault"
                style="width: max-content"
              >
                {{ "accounStatus" | translate }}
              </label>
              <br />
              <div
                class="form-types checkbox h-full flex-column position-absolute e-0"
              >
                <div class="checkbox-content relative {{ 'dir' | translate }}">
                  <!-- [checked]="item.status == 2" -->
                  <input
                    type="checkbox"
                    name="check"
                    [ngModel]="accounStatus"
                    #checkbox="ngModel"
                    [disabled]="selectItemOftree==true"
                    (change)="changeRequestStatus2($event)"
                  />
                  <div class="box {{ accounStatus ? 'checked' : 'blur' }}">
                    <span class="absolute">{{ "Inactive" | translate }}</span>
                    <span class="absolute">{{ "active" | translate }}</span>
                    <div class="cycle"></div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <p style="color: red;font-weight: bold;margin-bottom: 1px;" class="p-1 bg-red-100">
            تنبيه هام : يرجي الانتباه عند إضافة وحذف العناصر التالية :
          </p>
          <p style="color: red;font-weight: bold;margin-bottom: 1px;" class="p-1 bg-red-100">
            1- عميل جديد : إضافة عميل جديد : يتم إضافة عميل جديد وحذف عميل موجود مسبقا من شاشة العملاء و ليس من الدليل
          </p>

        </div>
        <!-- all buttons  -->
        <div class="btns mb-3 w-100">
          <div class="row d-md-flex justify-content-end">
            <button (click)="newAccount()"
              type="button"
              class="flex gap-1 btn bg-base text-white mb-3 col-md-2"
            >
              {{ "new" | translate }}
            </button>

            <button (click)="SaveAccount()"
            [disabled]="this.classification==null||this.Type==null||this.accountNameAR==null"
            type="button" class="btn bg-base text-white mb-3 col-md-2">
              {{ "save" | translate }}
            </button>

            <button
              type="button"
              class="flex gap-1 btn bg-base text-white mb-3 col-md-2"
              (click)="PrintTrewView('report')"
            >
              {{ "Print" | translate }}
              <i class="fa-solid fa-print"></i>
            </button>
            <button
              type="button"
              class="flex gap-1 btn bg-base text-white mb-3 col-md-2"
              (click)="MaintenanceFunc()"
            >
              {{ "Update and activate the directory" | translate }}
              <!-- <i class="fa-solid fa-print"></i> -->
            </button>
            <button
              type="button" (click)="exportData()"
              class="flex gap-1 btn btn-outline-secondary mb-3 col-md-2"
            >
              {{ "exportExcel" | translate }}
            </button>

            <button
              type="button"
              class="flex gap-1 btn btn-secondary mb-3 col-md-2 ms-3"
            >
              {{ "close" | translate }}
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
      <div
        class="grid gap-2 xl:grid-cols-5 md:grid-cols-3 sm:grid-cols-2 lg:grid-cols-4 align-items-center"
      >
      <div class="mb-3">
              <div class="form-group">
          <label class="col-form-label"> {{ "search" | translate }}</label>

          <input type="text " class="w-full p-2 inputType"autocomplete="off" name="search" (keyup)="applyFilter($event)"#input/>
        </div>
      </div>
    </div>
  <!-- table -->
  <div class="overflow-auto mt-4">
    <table
      *ngIf="showTable"
      mat-table
      [dataSource]="accountsDataSource"
      matSort
      class="mat-elevation-z8 rounded-t-lg overflow-hidden w-max"
    >
      <ng-container matColumnDef="accountCode">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>
          <span>{{ "account code" | translate }}</span>
        </th>
        <td mat-cell *matCellDef="let element">
          {{ element.accountCode }}
        </td>
      </ng-container>

      <ng-container matColumnDef="accountNameAR">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>
          <span>{{ "accountNameAR" | translate }}</span>
        </th>
        <td mat-cell *matCellDef="let element">
          {{ element.nameAr }}
        </td>
      </ng-container>

      <ng-container matColumnDef="accountNameLat">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>
          <span>{{ "accountNameLat" | translate }}</span>
        </th>
        <td mat-cell *matCellDef="let element">
          {{ element.nameEn }}
        </td>
      </ng-container>

      <ng-container matColumnDef="accountLevel">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>
          <span>{{ "accountLevel" | translate }}</span>
        </th>
        <td mat-cell *matCellDef="let element">
          {{ element.accountLevel }}
        </td>
      </ng-container>

      <ng-container matColumnDef="AccountClas">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>
          <span>{{ "AccountClas" | translate }}</span>
        </th>
        <td mat-cell *matCellDef="let element">
          {{ element.classificationName }}
        </td>
      </ng-container>

      <ng-container matColumnDef="accountType">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>
          <span>{{ "accountType" | translate }}</span>
        </th>
        <td mat-cell *matCellDef="let element">
          {{ element.typeName }}
        </td>
      </ng-container>

      <ng-container matColumnDef="MainAccount">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>
          <span>{{ "MainAccount" | translate }}</span>
        </th>
        <td mat-cell *matCellDef="let element">
          {{ element.parentAccountName }}
        </td>
      </ng-container>

      <ng-container matColumnDef="operations">
        <th
          mat-header-cell
          *matHeaderCellDef
          [translate]="'name'"
          [translateParams]="{
            ar: 'خيارات',
            en: 'Operations'
          }"
        ></th>
        <td mat-cell *matCellDef="let element">
          <div class="flex gap-1 justify-center py-2">
            <button
              type="button"
              id="68"
              class="p-2 bg-orange-100 hover:bg-orange-500 rounded-lg duration-300 hover:text-white w-10"
              data-toggle="tooltip"
              data-placement="top"
              (click)="onAccountCodeClick(element)"
            >
              <i class="fa-regular fa-pen-to-square"></i>
            </button>

            <button
              type="button"
              id="68"
              class="p-2 bg-red-100 hover:bg-red-500 rounded-lg duration-300 hover:text-white w-10 me-3"
              data-toggle="tooltip"
              data-placement="top"
              (click)="open(deleteModal, element, 'deleteItem')"
            >
              <i class="fa-solid fa-trash-can"></i>
            </button>
          </div>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="accountDisplayedColumns"></tr>

      <tr mat-row *matRowDef="let row; columns: accountDisplayedColumns"></tr>
    </table>

    <div *ngIf="!showTable" class="text-center">No Data Available in Table</div>
  </div>

  <mat-paginator *ngIf="showTable" [pageSizeOptions]="[10, 25,accountsDataSource.data.length]">
  </mat-paginator>

  <div id="report" [ngStyle]="{ direction: lang == 'ar' ? 'rtl' : 'ltr' }" style="position: absolute;">
    <!--Header-->
    <div
      class="report-header"
      style="
        display: flex;
        align-items: center;
        gap: 100px;
        padding: 3px 0px;
        margin-bottom: 20px;
      "
    >
      <div class="headerNe-right-side">
        <img
        src="{{environmentPho}}"
          alt="logo"
          style="height: 200px; width: 200px; max-width: 200px; object-fit: fill"
        />
      </div>

      <div class="headerNe-lefy-side" style="width: 100%">
        <h1
          style="
            letter-spacing: 0.25px;
            font-size: 23px;
            margin: 0;
            margin-bottom: 5px;
          "
        >
        {{OrganizationData?.nameAr}}
        </h1>
        <h1
          style="
            letter-spacing: 0.25px;
            font-size: 23px;
            margin: 0;
            margin-bottom: 5px;
          "
        >
        {{OrganizationData?.nameEn}}
        </h1>
        <div class="line" style="position: relative; padding: 5px 0px 10px">
          <span
            style="
              position: absolute;
              right: 0;
              width: 100%;
              height: 2px;
              background-color: #e5e5e5;
              z-index: 1;
            "
          ></span>
          <span
            style="
              position: absolute;
              right: 0;
              width: 70%;
              height: 2px;
              background-color: #ec1c24;
              z-index: 2;
            "
          ></span>
        </div>

        <h1
          style="
            margin-bottom: 0;
            font-size: 34px;
            color: #0c8191;
            margin-bottom: 0;
            margin-top: 30px;
            font-weight: 500;
          "
          [translate]="'name'"
          [translateParams]="{
            ar: ' دليل الحسابات',
            en: 'Accounts guide'
          }"
        ></h1>
      </div>
    </div>
    <!--/Header-->

    <div style="margin-bottom: 10px">
      <p>
        <span
          [translate]="'name'"
          [translateParams]="{
            ar: 'التاريخ: ',
            en: 'Date: '
          }"
        ></span>
        <span> {{dateprint}} </span>
      </p>
    </div>

    <div class="services" style="width: 100%; margin-bottom: 20px">
      <div class="content">
        <div class="tree">
          <tree-ngx
          [nodeItems]="AccountngxTree"
          class="{{ 'dir' | translate }}"
          [options]="options"
        >
          <ng-template #nodeCollapsibleTemplate let-expanded="expanded">
            <span *ngIf="!expanded">
              <i class="fa-solid fa-folder-plus tree-icon"></i>
            </span>
            <span *ngIf="expanded">
              <i class="fa-solid fa-folder-minus tree-icon"></i>
            </span>
          </ng-template>
        </tree-ngx>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- deleteModal -->
<ng-template #deleteModal let-modal>
  <div class="modal-body text-center">
    <p
      [translate]="'name'"
      [translateParams]="{
        ar: 'هل تريد حذف هذا العنصر ؟',
        en: 'Do you want to delete this item?'
      }"
    ></p>
    <div class="flex gap-2 justify-center">
      <button
        type="button"
        (click)="modal.dismiss()"
        mat-raised-button
        color="basic"
      >
        {{ "close" | translate }}
      </button>

      <button
        type="button"
        mat-raised-button
        color="warn"
        (click)="deleteItemselected(modal)"
      >
        {{ "confirem" | translate }}
      </button>
    </div>
  </div>
</ng-template>

<!-- <div id="print-voucher" style="opacity: 0; position: fixed">awdawd</div> -->
